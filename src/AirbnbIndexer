import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.document.*;
import org.apache.lucene.index.*;
import org.apache.lucene.store.FSDirectory;
import org.apache.lucene.index.IndexWriterConfig.OpenMode;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.nio.file.Paths;

public cass AirbnbIndexer{
    public static void main(String[] args) throws Exception{
        String indexPath = "airbnb_index";
        String dataFilePath = "/data/listings.csv";

        try{
            FSDirectory dir = FSDirectory.open(Paths.get(indexPath));
            StandardAnalyzer analyzer = new StandardAnalyzer();

            // OpenMode.CREATE → elimina el índice previo y crea uno nuevo
            // OpenMode.CREATE_OR_APPEND → deja lo existente y añade más documentos
            IndexWriterConfig config = new IndexWriterConfig(analyzer);
            config.setOpenMode(OpenMode.CREATE_OR_APPEND);
            
            IndexWriter writer = new IndexWriter(dir, config);

            BufferedReader br = new BufferedReader(new FileReader(csvPath));
            String line = br.readLine(); // leer encabezado
            
            while ((line = br.readLine()) != null) {
                String[] fields = parseCSV(line);

                // Ajustar según columnas del CSV real
                String id = fields[0];
                String name = fields[1];
                String neighbourhood = fields[2];
                String roomType = fields[3];
                int price = Integer.parseInt(fields[4]);
                String description = fields[5];

                Document doc = new Document();
                doc.add(new StringField("listing_id", id, Field.Store.YES));
                doc.add(new TextField("name", name, Field.Store.YES));
                doc.add(new TextField("neighbourhood", neighbourhood, Field.Store.YES));
                doc.add(new StringField("room_type", roomType, Field.Store.YES));

                doc.add(new IntPoint("price", price));
                doc.add(new StoredField("price", price));

                doc.add(new TextField("description", description, Field.Store.YES));

                writer.addDocument(doc);
            }
            br.close();
            writer.close();

            System.out.println("Indexación completada. Puedes abrirlo en Luke.");
        } catch (IOException e) {
            System.out.println("Error during indexing process.");
            e.printStackTrace();
        }


    private static String[] parseCSV(String line) {
        return line.split(",(?=([^\"]*\"[^\"]*\")*[^\"]*$)");
    }

    }

.

}